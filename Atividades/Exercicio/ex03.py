import matplotlib.pyplot as plt

krtv_int =  [
    0.159996,
    0.14889672770282075,
    0.16102356635666792,
    0.16140552924824475,
    0.17574065905808914,
    0.1741480372941681,
    0.18608077554476007,
    0.17276052950634688,
    0.17634297746623037,
    0.17383076937891995,
    0.17446292058078994,
    0.18678056998217465,
    0.15256677804468868,
    0.1505630866001286,
    0.15692939898050268,
    0.1678929926895277,
    0.18045774919776597,
    0.1843082889871573,
    0.19068292844386647,
    0.18271395072489208,
    0.1838495852178964,
    0.1865445268883808,
    0.17842190700307858,
    0.17107723611049883,
    0.15018353165980264,
    0.14858125667483874,
    0.16389565381918048,
    0.17561306952869885,
    0.18798428727082797,
    0.17680108357884938,
    0.18831375602140718,
    0.1886245668899958,
    0.18089869401756256,
    0.18854635032803238,
    0.1742906578509449,
    0.17864978366980627,
    0.1566198462954932,
    0.1803064855349327,
    0.16190971456352402,
    0.16562133774205465,
    0.17966214237580602,
    0.17463249188075014,
    0.18590276472389713,
    0.19319337784490562,
    0.18346488336757025,
    0.17828174748503905,
    0.16575988537396952,
    0.17486267264606548,
    0.18585124586313448,
    0.1708816873110495,
    0.15658370131413732,
    0.16182833924651108,
    0.17777073033038254,
    0.17390828128807276,
    0.1746645880051691,
    0.18242869807327983,
    0.18053118754894634,
    0.18299158732272253,
    0.18125917360049942,
    0.1696210720448827,
    0.16944804832040597,
    0.16785163915455417,
    0.1537293047221951,
    0.15910488099744047,
    0.16123395972285598,
    0.16909786399536972,
    0.1771006103570622,
    0.18323307082169013,
    0.18585780319451065,
    0.18343206183319194,
    0.17979806897401604,
    0.17316274765195339,
    0.16995598489250902,
    0.16916297782357953,    
]

naus_int = [
    0.905814,
    0.9019563868002788,
    0.8735621326017012,
    0.8687442531809155,
    0.8662114092865238,
    0.8808568094275735,
    0.8590072047845833,
    0.90115948825707,
    0.8947287271393745,
    0.9150215008377257,
    0.9115292754145743,
    0.8929147980819333,
    0.9098562850083332,
    0.8929638363125472,
    0.8912332893759778,
    0.8664863123996226,
    0.8689148624738078,
    0.8449696603175345,
    0.8448030547935901,
    0.8665783798914546,
    0.878653407534172,
    0.9041453799678207,
    0.9034473027341811,
    1.031353939385706,
    0.8233395677262698,
    0.7901653741295198,
    0.8581593437902243,
    0.8621454929243829,
    0.8331998599441478,
    0.8339275342931362,
    0.8541814349366517,
    0.8437499270601969,
    0.8670283753027672,
    0.8935821231624699,
    0.9009486402662166,
    0.9084881555757357,
    0.9616670065467076,
    0.89745264594575,
    0.8831937031071334,
    0.8731188456244036,
    0.8747002538132223,
    0.842029154868078,
    0.8576427278242558,
    0.8678771554964184,
    0.8758261943855208,
    0.8926630209490056,
    0.9015422094791313,
    0.9304067610771029,
    0.9112193109264385,
    0.8980365873029681,
    0.8893161649474898,
    0.8711337177792953,
    0.8682219555843856,
    0.868127591686604,
    0.8521424523363647,
    0.8429467274791954,
    0.8642076800970345,
    0.9009355719493847,
    0.9132162741877412,
    0.7700461752413842,
    0.9079002248515655,
    0.9198952124193059,
    0.8989290812952272,
    0.8940990165892221,
    0.8857787181955847,
    0.8718930183169563,
    0.8697138366316676,
    0.8763391492694199,
    0.8811932153622577,
    0.8897400004958904,
    0.9265527278832133,
    0.9398329651174836,
    0.9320374381366567,
    0.9375404289465396,
]

# Defasagem (variação temporal entre as séries)
defasagem = [
    -36, -35, -34, -33, -32, -31, -30, -29, -28, -27, -26, -25, -24, 
    -23, -22, -21, -20, -19, -18, -17, -16, -15, -14, -13, -12, -11, 
    -10, -9, -8, -7, -6, -5, -4, -3, -2, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 
    10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36 
]


# Cálculo da média das estações (média dos valores interpolados)
naus_media = sum(naus_int) / len(naus_int)
krtv_media = sum(krtv_int) / len(krtv_int)

# Cálculo do desvio padrão das estações (dp dos valores interpolados)
naus_dp = (sum((x - naus_media) ** 2 for x in naus_int) / (len(naus_int) - 1)) ** 0.5
krtv_dp = (sum((x - krtv_media) ** 2 for x in krtv_int) / (len(krtv_int) - 1)) ** 0.5

# Lista para armazenar as correlações calculadas para cada defasagem
correlacoes = []

# Loop sobre cada defasagem
for defa in defasagem:
    if defa >= 0:
        # Calcula a correlação para defasagem positiva
        correlacao = sum(((x - naus_media) * (y - krtv_media)) for x, y in zip(naus_int[:len(naus_int)-defa], krtv_int[defa:]))
    elif defa == 0:
        # Calcula a correlação para defasagem zero
        correlacao = sum((x * y) for x, y in zip(naus_int, krtv_int)) / (len(naus_int))
    else:
        # Calcula a correlação para defasagem negativa
        correlacao = sum(((x - krtv_media) * (y - naus_media)) for x, y in zip(krtv_int[:len(krtv_int)+defa], naus_int[-defa:]))
    
    # Normaliza a correlação pelos desvios padrão
    correlacoes.append({'Defasagem': defa, 'Correlacao': correlacao / (len(naus_int) * naus_dp * krtv_dp)})

# Imprime as correlações calculadas
for i in correlacoes:
    print(i)

# Função para plotar o gráfico de barras com as correlações
def plot_correlacoes(correlacoes):
    defasagens = [item['Defasagem'] for item in correlacoes]
    correlacoes_vals = [item['Correlacao'] for item in correlacoes]

    # Gera o gráfico de barras
    plt.bar(defasagens, correlacoes_vals, width=0.5, color='steelblue')
    
    # Adiciona títulos e rótulos aos eixos
    plt.title('Correlograma do componente Up das estações NAUS e KRTV')
    plt.xlabel('Defasagens')
    plt.ylabel('Correlação')
    plt.xticks([-30, -20, -10, 0, 10, 20, 30])  # Define os ticks no eixo x
    plt.yticks([-0.6, -0.4, -0.2, 0, 0.2, 0.4, 0.6])  # Define os ticks no eixo y
    
    # Exibe o gráfico
    plt.show()

# Chama a função para plotar o gráfico com as correlações calculadas
plot_correlacoes(correlacoes)